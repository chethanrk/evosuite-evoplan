<mvc:View controllerName="com.evorait.evoplan.controller.ResourceTree"
          xmlns:core="sap.ui.core"
          xmlns="sap.m"
          xmlns:mvc="sap.ui.core.mvc"
          xmlns:f="sap.f"
          xmlns:table="sap.ui.table"
          xmlns:controls="com.evorait.evoplan.ui.controls"
          displayBlock="true"
          height="100%">

    <Page id="masterPage"
          title="{i18n>masterTitle}"
          showFooter="true"
          showHeader="true"
          class="sapUiNoContentPadding tableContentPage">

        <customHeader>
            <Bar>
                <contentLeft>
                    <Image src="{path: '', formatter: '.formatter.getLogoImageLink' }"
                           densityAware="false"
                           height="100%"
                           alt="EvoPlan"
                           id="imageLogo"/>
                </contentLeft>
            </Bar>
        </customHeader>

        <f:DynamicPage id="idResourcePage"
                       headerExpanded="true"
                       preserveHeaderStateOnScroll="true"
                       fitContent="false"
                       showFooter="false"
                       toggleHeaderOnTitleClick="false">
            <f:header>
                <f:DynamicPageHeader pinnable="true">
                    <f:content>
                        <FlexBox alignItems="Start"
                                 justifyContent="SpaceBetween">
                            <items>
                                <controls:CustomVariantManagement
                                        id="customResourceVariant"
                                        select="onSelectVariant"
                                        initialise="onInitialiseVariant"
                                        enabled="true"
                                        showExecuteOnSelection="true"
                                        showShare="true"
                                        lifecycleSupport="true"
                                        persistencyKey="{viewModel>/persistencyKeyTree}"
                                        entitySet="{viewModel>/treeSet}">
                                </controls:CustomVariantManagement>

                                <Button type="Transparent"
                                        id="filterResourceButton"
                                        icon="sap-icon://filter"
                                        text="{viewModel>/counterResourceFilter}"
                                        press="onFilterButtonPress" />
                            </items>
                        </FlexBox>
                        <SearchField id="searchField"
                                     search="onSearchResources"
                                     showRefreshButton="{= !${device>/support/touch} }"
                                     width="100%">
                        </SearchField>
                    </f:content>
                </f:DynamicPageHeader>
            </f:header>

            <f:content>
                <table:TreeTable
                        id="droppableTable"
                        selectionMode="None"
                        enableColumnReordering="false"
                        class="listTreeTable"
                    	rows="{
                        		path : '/ResourceHierarchySet',
                        		parameters:{
                        			numberOfExpandedLevels:1,
                        			restoreTreeStateAfterChange:true
                        		}
                        }">
                    <table:columns>
                        <table:Column
                                label="{i18n>xtit.tableObject}"
                                name="{i18n>xtit.tableObject}">
                            <table:template>
                                <controls:CustomTitle
                                        text="{Description}"
                                        tooltip="{Description}"
                                        titleStyle="{
                                            path: 'NodeType',
                                            formatter: '.formatter.formatResourceTitle'
                                        }"
                                        availabilityIcon="{
                                           path: 'IS_AVAILABLE',
                                           formatter: '.formatter.getAvailabilityIcon'
                                        }"
                                        iconColor="{
                                           path: 'IS_AVAILABLE',
                                           formatter: '.formatter.formatIconColor'
                                        }"
                                        iconTooltip="{
                                           path: 'IS_AVAILABLE',
                                           formatter: '.formatter.formatIconTooltip'
                                        }"
                                        icon="{
                                              parts:[{path: 'NodeType'},{path: 'StatusIcon'}],
                                              formatter: '.formatter.getResourceIcon'
                                        }"
                                        isLink="{
                                              path: 'NodeType',
                                              formatter: '.formatter.isAssignment'
                                        }"
                                        press="onPressAssignmentLink"/>
                            </table:template>
                        </table:Column>
                        <table:Column
                                label="{i18n>xtit.tableWorkload}"
                                name="{i18n>xtit.tableWorkload}"
                                width="5rem"
                                hAlign="End"
                                visible="{= ${/#ResourceHierarchy/Utilization/@sap:visible} === 'true'? true : false }">
                            <table:template>
                                <ProgressIndicator
                                        percentValue="{Utilization}"
                                        displayValue="{Utilization}%"
                                        showValue="true"
                                        state="None"
                                        visible="{
                                              path: 'NodeType',
                                              formatter: '.formatter.isMainResource'
                                        }"/>
                            </table:template>
                        </table:Column>
                        <table:Column
                                label="{i18n>xtit.tableAssignment}"
                                name="{i18n>xtit.tableAssignment}"
                                width="3rem"
                                hAlign="End">
                            <table:template>
                                <Text text="{AssignmentCount}"
                                      visible="{= ${NodeType} === 'ASSIGNMENT' ? false : true }"
                                      wrapping="false" />
                            </table:template>
                        </table:Column>
                        <table:Column
                                label="{i18n>xtit.tableCheckbox}"
                                name="{i18n>xtit.tableCheckbox}"
                                width="4rem"
                                hAlign="Center"
                                class="sapUiNoContentPadding">
                            <table:template>
                                <CheckBox enabled="true"
                                          select="onChangeSelectResource"
                                          visible="{
                                              path: 'NodeType',
                                              formatter: '.formatter.isMainResource'
                                              }" 
                                              selected="{IsSelected}"/>
                            </table:template>
                        </table:Column>
                    </table:columns>
                </table:TreeTable>
            </f:content>

        </f:DynamicPage>

        <footer>
            <OverflowToolbar>
                <ToolbarSpacer/>
                <Button id="idButtonunassign"
                        text="{i18n>xbut.buttonUnassign}"
                        tooltip="{i18n>xbut.buttonUnassign}"
                        press="onPressUnassign"
                        enabled="false">
                    <layoutData>
                        <ToolbarLayoutData shrinkable="true" />
                    </layoutData>
                </Button>
                <Button id="idButtonreassign"
                        text="{i18n>xfld.newAssign}"
                        tooltip="{i18n>xfld.newAssign}"
                        press="onPressReassign"
                        enabled="false">
                    <layoutData>
                        <ToolbarLayoutData shrinkable="true" />
                    </layoutData>
                </Button>
                <Button id="showPlanCalendar"
                        text="{i18n>xbut.showPlanningCal}"
                        tooltip="{i18n>xbut.showPlanningCal}"
                        icon="sap-icon://calendar"
                        press="onPressShowPlanningCal"
                        enabled="false">
                    <layoutData>
                        <ToolbarLayoutData shrinkable="true" />
                    </layoutData>
                </Button>
            </OverflowToolbar>
        </footer>
    </Page>
</mvc:View>